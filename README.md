# fMRIPrepCleanup

## Background

fMRIPrep (https://fmriprep.org) is an optimised fMRI preprocessing pipeline that combines best practice tools from a number of sources. This includes the generation of a large number of files, including those prodcued as preprocessed output that will be used in subsequent analysis, outpit files that could be used by the researcher but in practice may never be used, and working directory files which are temporary in nature and are very unlikely to serve a practical use.

Severs use energy not only to process data, but also to store it. Additionally, filling servers with data increases the need to produce and purchase additional hardware to accomodate new projects. In both of these ways, the accumulation of unneeded 'junk' data contributes to the carbon footprint of research computing.

## Usage

As such, we provide here a script that can be used to automatically identify and delete junk files produced by fMRIPrep, used as follows:

```
fMRIPrepCleanup.py path/to/fMRIPrep/directory/
```

This script was written under the assumption that all files generated by fMRIPrep (including output files, log files, and working directory files) that the user might want tidied up are contained somewhere within this directory. However, the script does not rely on any particular file structure or naming convention. Depending on how you have structured your output folders, this could be run at the level of one participant or a full sample. This script works by deleting all files that do not contain specific strings in their name.

**PLEASE NOTE: The files targetted here for retention and deletion are based on those useful to the authors of this script given our purposes. In its current form, this script will delete fMRIPrep output files that other researchers may have good thoeretical motivations to retain, such as those generated by FreeSurfer surface reconstruction. As such, researchers should make sure they fully understand the execution of this code before using it on their data, and update it as necessary. Without this, one may risk irrevocably deleting important data. Improper use of this script could be particularly catastrophic if pointed at a directory that contains files other than those generated by fMRIPrep, these will also be deleted. We recommend testing this script on a copy of one subject's preprocessed data before using it on the full sample/original data.**

Strings currently flagged for retention (with rationale for each):

- '*preproc*': Targets any preprocessed functional and anatomical files generated by fMRIPrep, in each output space generated.
- '*brain_mask*': Targets the brain 'mask' generated by fMRIPrep that accompanies each preprocessed functional and anatomical output file.
- '*confounds*': Targets the confounds TSV file generated for each BOLD run, as this data is often used in subsequent analysis steps.
- '*html*': Targets the final output report generated by fMRIPrep for each subject, as well as some of the 'figures' used to populate it.
- '*svg*': Targets the remaining 'figures' used to populate the output report for each subject.
- '*emissions*': Targets the estimated carbon emissions output file generated by CodeCarbon (if toggled on when running fMRIPrep using the 'track-cabron' flag, which we recommand for monitoring purposes).

Any folders that are themselves totally empty following file deletion will themselves be deleted, to provide a cleaner view of what remains in your fMRIPrep directory. Note that some non-target files do slip through the cracks accoridng to the inclusion criteria specified above. As such, the following are specificially targetted for deletion:

- '*index.html*': A non-subject-specific working directory file that will not be needed.
- '*single_subject_{subject number}_wf*': Subject specific working directory folders that would otherwise remain given the presence of HTML files as well as several containing the string 'preproc'.
- '*fsaverage*': A non-subject-specific FreeSurfer output directory folder that would otherwise remain given the presence of two files containing the string 'preproc'.

